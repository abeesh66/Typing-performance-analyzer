import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

public class TypingAnalyzer {

    public static void main(String[] args) {
        SwingUtilities.invokeLater(MainMenu::new);
    }
}

class MainMenu extends JFrame {

    public MainMenu() {
        setTitle("Typing Performance Analyzer");
        setSize(400, 250);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        JPanel panel = new JPanel(new GridLayout(3, 1, 10, 10));

        JButton startButton = new JButton("Start Typing Test");
        JButton exitButton = new JButton("Exit");

        panel.add(startButton);
        panel.add(exitButton);

        add(panel);

        // Actions
        startButton.addActionListener(e -> {
            new TypingTest();
            dispose();
        });

        exitButton.addActionListener(e -> System.exit(0));

        setVisible(true);
    }
}

class TypingTest extends JFrame {
    private JTextArea textToType;
    private JTextArea userInput;
    private long startTime;

    private String sampleText = "Typing is a fundamental skill that helps in improving speed and accuracy. "
            + "Practice daily to become better at typing.";

    public TypingTest() {
        setTitle("Typing Test");
        setSize(600, 400);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        textToType = new JTextArea(sampleText);
        textToType.setLineWrap(true);
        textToType.setWrapStyleWord(true);
        textToType.setEditable(false);
        textToType.setFont(new Font("Arial", Font.PLAIN, 16));

        userInput = new JTextArea();
        userInput.setLineWrap(true);
        userInput.setWrapStyleWord(true);
        userInput.setFont(new Font("Arial", Font.PLAIN, 16));

        JScrollPane scroll1 = new JScrollPane(textToType);
        JScrollPane scroll2 = new JScrollPane(userInput);

        JButton finishButton = new JButton("Finish Test");

        // Start timer when user begins typing
        userInput.addKeyListener(new KeyAdapter() {
            public void keyPressed(KeyEvent e) {
                if (startTime == 0) {
                    startTime = System.currentTimeMillis();
                }
            }
        });

        finishButton.addActionListener(e -> calculateResults());

        setLayout(new BorderLayout());
        add(scroll1, BorderLayout.NORTH);
        add(scroll2, BorderLayout.CENTER);
        add(finishButton, BorderLayout.SOUTH);

        setVisible(true);
    }

    private void calculateResults() {
        long endTime = System.currentTimeMillis();
        double timeTaken = (endTime - startTime) / 1000.0 / 60.0; // in minutes

        String typedText = userInput.getText();

        int totalWords = typedText.split("\\s+").length;
        int correctChars = 0;
        int totalChars = Math.min(typedText.length(), sampleText.length());

        for (int i = 0; i < totalChars; i++) {
            if (typedText.charAt(i) == sampleText.charAt(i)) {
                correctChars++;
            }
        }

        double wpm = totalWords / timeTaken;
        double accuracy = (correctChars / (double) sampleText.length()) * 100;

        new ResultScreen(wpm, accuracy);
        dispose();
    }
}

class ResultScreen extends JFrame {
    public ResultScreen(double wpm, double accuracy) {
        setTitle("Test Results");
        setSize(400, 250);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        JPanel panel = new JPanel(new GridLayout(4, 1, 10, 10));

        DateTimeFormatter dtf = DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm:ss");
        String timeStamp = dtf.format(LocalDateTime.now());

        JLabel wpmLabel = new JLabel("Words per Minute: " + String.format("%.2f", wpm));
        JLabel accLabel = new JLabel("Accuracy: " + String.format("%.2f", accuracy) + "%");
        JLabel timeLabel = new JLabel("Test taken at: " + timeStamp);

        JButton backButton = new JButton("Back to Menu");

        panel.add(wpmLabel);
        panel.add(accLabel);
        panel.add(timeLabel);
        panel.add(backButton);

        add(panel);

        backButton.addActionListener(e -> {
            new MainMenu();
            dispose();
        });

        setVisible(true);
    }
} 